<html>

<link rel="stylesheet" href="./stylesheets/main.css" type="text/css">
<style>

</style>
<body>
	<div id="container">
		<div id="header"><img src="./images/nef_logo.png" alt="nefheader"></div>
		<div id="donationdiv">
			<!-- <ul> -->
				<!-- <li> -->
				<div id="christmasdiv"><canvas id="christmas" width="450" height="600"></canvas></div>
				<div id="donationbody"><img src="./images/body.png"><br /><img src="./images/donate_today.png" id="startDonate"></div>
				<!-- </li> -->
			<!-- </ul> -->
			<!-- <ul>
				<li ><button type ="button" id="startDonate">Donate</button></li>
				<li><button type =submit id="endDonate">Donation done</button></li>
			</ul> -->
		</div>
		<div id="footer"><img src="./images/numbers.png"></div>
	</div>
</body>
<script>
	var canvas = document.getElementById('christmas');
	var context = canvas.getContext('2d');
	var lights = [];
	var src = 'images/test.png';
	var twinkle, audio, litLights = 0, decorations = 0;

	// fitToContainer(canvas);

	function fitToContainer(canvas){
	  canvas.style.width='100%';
	  canvas.style.height='100%';
	  canvas.width  = canvas.offsetWidth;
	  canvas.height = canvas.offsetHeight;
	}
	
	function drawStar(cx, cy, outerRadius, innerRadius) {
		var rot = Math.PI / 2 * 3;
		var x = cx;
		var y = cy;
		var step = Math.PI / 5;
		context.beginPath();
		var stx, sty;	
		context.moveTo(cx, cy - outerRadius)
		for (i = 0; i < 5; i++) {
			x = cx + Math.cos(rot) * outerRadius;
			y = cy + Math.sin(rot) * outerRadius;
			context.lineTo(x, y)
			rot += step

			x = cx + Math.cos(rot) * innerRadius;
			y = cy + Math.sin(rot) * innerRadius;
			context.lineTo(x, y);
			if(i == 2){
				stx=x;sty=y;
			}
            rot += step;
		}
		context.lineTo(cx, cy - outerRadius);
		context.closePath();
		context.lineWidth=5;
		context.strokeStyle='black';
		context.stroke();
		context.fillStyle='yellow';
		context.fill();
		return {x:stx,y:sty};
	}
	
	function drawSector(cx,cy){
		var radius = 250, startAngle = 0.3, endAngle = 0.7;

		for (i=0; i<3; i++){
			context.beginPath();
			context.moveTo(cx,cy);
			context.arc(cx,cy,radius,startAngle*Math.PI,endAngle*Math.PI);
			context.lineTo(cx,cy);
			context.closePath();
			context.strokeStyle='green';
			context.stroke();
			context.fillStyle='green';
			context.fill();
			radius = radius + 50;
			startAngle = startAngle +  0.05;
			endAngle = endAngle - 0.05;
		}
	}
   
	function drawLights(cx,cy){
		var totalLights = 22;
		litLights = parseInt(localStorage.getItem("litLights"));
		
		var img = new Image();
		img.onload = function(){
		    placeLightsOnTree(3, 50, 0.28, 0.15, img);
			placeLightsOnTree(6, 150, 0.3, 0.07, img);
			placeLightsOnTree(8, 225, 0.3, 0.05, img);
			placeLightsOnTree(5, 300, 0.35, 0.055, img);
			
		}
		img.src="images/test.png";
    
	}
	function placeLightsOnTree(numberOfLights, radius, theta, thetaIncrement, img){
	    for(i = 0; i < numberOfLights; i++)
		{
		    x = radius*Math.cos(theta*Math.PI)+starCentre.x-20;
			y = radius *Math.sin(theta*Math.PI) + starCentre.y;
			addToLights(x,y);
			context.drawImage(img,x, y);	
		    theta = theta + thetaIncrement;
		}
	}
	function addToLights(x,y){
		var lightInfo = {};
		lightInfo.x = x;
		lightInfo.y = y;
		lights.push(lightInfo);
		return lights;

	}
	
	function drawTrunk(cx, cy){
		context.fillStyle='brown';
		context.fillRect(cx, cy, 40, 50);
	}
	
    function animate(){
	   src = src === 'images/test1.png' ? 'images/test.png' : 'images/test1.png';
	   var img = new Image();
	   img.onload = function(){
          for (var i=0; i< lights.length; i++){
		     context.drawImage(img, lights[i].x, lights[i].y);
		}
	    
	   }
	   img.src= src;
	}

    function generateRandomGifts(){
	  var sectorNumber = getRandomNumber(1,4);
	  console.log(sectorNumber);
	  var giftCoord = getXYCoordinates(sectorNumber);
	  
	  drawGift(getRandomNumber(1,7), giftCoord);
	}
    function drawGift(x, xyCoord){
	  switch(x){
	    case 1:
		    var img = new Image();
			img.onload = function(){
			  context.drawImage(img, xyCoord.x, xyCoord.y);
			}
		    img.src = "images/sock.png";
			break;
		case 2:
		var img = new Image();
			img.onload = function(){
			  context.drawImage(img, xyCoord.x, xyCoord.y);
			}
		    img.src = "images/snow.png";

		    break;
		case 3:
		var img = new Image();
			img.onload = function(){
			  context.drawImage(img, xyCoord.x, xyCoord.y);
			}
		    img.src = "images/candy.png";

		   break;
		case 4:
		var img = new Image();
			img.onload = function(){
			  context.drawImage(img, xyCoord.x, xyCoord.y);
			}
		    img.src = "images/bell.png";

		  break;
		case 5:
           var img = new Image();
		   img.onload = function(){
			  context.drawImage(img, xyCoord.x, xyCoord.y);
		   }
		   img.src = "images/redball.png";
		
		break;
		 case 6:
		    var img = new Image();
			img.onload = function(){
			  context.drawImage(img, xyCoord.x, xyCoord.y);
			}
		    img.src = "images/blueball.png";

		   break;
		 default:
		   var img = new Image();
			img.onload = function(){
			  context.drawImage(img, xyCoord.x, xyCoord.y);
			}
		    img.src = "images/hamper.png";

		    break;
	  
	  
	  }
	}
    function getRandomNumber(min, max, decimal){
	if (decimal){
	    return Math.random() * (max - min) + min;
	} else {
	      return Math.floor(Math.random() * (max - min + 1)) + min;
	}
	 
	}
	function getXYCoordinates(x){
	
	    switch (x){
		    
		    case 1:
			var radius = getRandomNumber(starCentre.y+10, starCentre.y+250) - (starCentre.y+10);
			return getXYLimits(radius,getRandomNumber(0.35,0.65, true));
			case 2:
			 var radius = getRandomNumber(starCentre.y+10, starCentre.y+310) - (starCentre.y+10);
			 return getXYLimits(radius, getRandomNumber(0.35,0.65, true) );
			break;
			case 3:
			var radius = getRandomNumber(starCentre.y+10, starCentre.y+340) - (starCentre.y+10);
			return getXYLimits(radius, getRandomNumber(0.35, 0.65, true));
			break;
			case 4:
			var xyCoord = {};
			xyCoord.x = getRandomNumber(starCentre.x-60, starCentre.x+60);
			xyCoord.y = getRandomNumber(starCentre.y+360, starCentre.y +410);
			return xyCoord;
			break;
			
		}
		function getXYLimits(r, theta){
		    var xyCoord = {};
			xyCoord.x = r*Math.cos(theta*Math.PI)+starCentre.x-20;
			xyCoord.y = r*Math.sin(theta*Math.PI) +starCentre.y+10;
			console.log(r, theta);
			return xyCoord;
		}
	}
    var starCentre = drawStar(220, 100, 15, 5);
    
	drawSector(starCentre.x, starCentre.y+10);
	drawLights(starCentre.x, starCentre.y);
	drawTrunk(starCentre.x-20, starCentre.y+360);
	context.restore();
    document.getElementById('startDonate').onclick = function(){
	  twinkle = setInterval(animate, 500);
	  audio =  new Audio('assets/christmasjingle.mp3');
      audio.play();
	};
	document.getElementById('endDonate').onclick = function(){
	    audio.pause();
		clearInterval(twinkle);
		//litLights - value from server
		if (typeof(Storage) !== "undefined") {
         litLights = parseInt(localStorage.getItem("numberOfLitLights"));
		}
		if(litLights == null)
		  litLights = 0;
		var img = new Image();
		img.onload = function(){
		   for (var i=0; i< litLights; i++){
		     context.drawImage(img, lights[i].x, lights[i].y);
		   }
		   context.drawImage(img, lights[i].x, lights[i].y);
		   if(litLights > 5)
			generateRandomGifts();	 
			context.save();
		}
		img.src = "images/test1.png";
		var img1 = new Image();
		img1.onload = function(){
		   for (var i=litLights; i< lights.length; i++){
		     context.drawImage(img1, lights[i].x, lights[i].y);
		   }
		   context.save();
		}
		img1.src = "images/test.png";
		litLights++;
	    localStorage.setItem("numberOfLitLights", litLights);
		
	};
//generateRandomGifts();
</script>         
</html>